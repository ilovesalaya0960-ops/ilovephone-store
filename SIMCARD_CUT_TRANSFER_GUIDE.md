# คู่มือการใช้งาน: ตัด/ย้ายซิมการ์ด

## ✅ ระบบซิมการ์ดมีฟังก์ชันครบถ้วนแล้ว!

เมนู **"ตัด"** ซิมการ์ดมีตัวเลือกเหมือนกับเมนู "ตัด" เครื่องแล้ว ประกอบด้วย:

### 1. **ย้ายภายใน** (Transfer) - ย้ายไปร้านอื่น
- ✅ ย้ายซิมการ์ดไปแสดงในร้านอื่น
- ✅ ซิมจะหายจากร้านต้นทาง
- ✅ ซิมจะปรากฏในสต็อกของร้านปลายทาง
- ✅ ไม่ต้องกรอกราคาตัด

### 2. **ย้ายภายนอก** (Cut) - ตัดออกจากระบบ
- ✅ ตัดซิมออกจากระบบ
- ✅ บันทึกราคาที่ตัด
- ✅ ย้ายไปแท็บ "ตัดออก"
- ✅ ต้องกรอกราคาตัด

---

## 📋 การใช้งาน

### **วิธีที่ 1: ย้ายซิมไปร้านอื่น**

1. เลือกซิมการ์ด → การจัดการ → **ตัด** → **ตกลง**
2. Modal "ตัดซิมการ์ด" จะเปิดขึ้น
3. เลือก **ประเภทการตัด**: **ย้ายภายใน**
4. เลือก **ย้ายไปร้าน**: เลือกร้านปลายทาง
   - ร้านไอเลิฟโฟน - ศาลายา
   - ร้านไอเลิฟโฟน - คลองโยง
5. เลือก **วันที่**
6. กรอก **หมายเหตุ** (ถ้ามี)
7. กด **ยืนยันย้ายซิมการ์ด**

**ผลลัพธ์:**
- ✅ ซิมหายจากร้านเดิม
- ✅ ซิมปรากฏในร้านปลายทาง
- ✅ บันทึกหมายเหตุว่า "ย้ายไป ร้านศาลายา 26/11/2568"

---

### **วิธีที่ 2: ตัดซิมออกจากระบบ**

1. เลือกซิมการ์ด → การจัดการ → **ตัด** → **ตกลง**
2. Modal "ตัดซิมการ์ด" จะเปิดขึ้น
3. เลือก **ประเภทการตัด**: **ย้ายภายนอก**
4. กรอก **ราคาที่ตัด (฿)**: เช่น 35.00
5. เลือก **วันที่**
6. กรอก **หมายเหตุ** (ถ้ามี)
7. กด **ยืนยันตัดซิมการ์ด**

**ผลลัพธ์:**
- ✅ ซิมหายจากแท็บ "พร้อมขาย"
- ✅ ซิมปรากฏในแท็บ "ตัดออก"
- ✅ บันทึกราคาที่ตัด
- ✅ เปลี่ยน status = 'removed'

---

## 🔄 Flow การทำงาน

### **ย้ายภายใน (Transfer)**
```
1. เลือก "ย้ายภายใน"
2. เลือกร้านปลายทาง (required)
3. ไม่ต้องกรอกราคา
4. ยืนยันย้าย
   ↓
5. อัปเดต store ของซิม
6. เพิ่มหมายเหตุ "ย้ายไป..."
7. ซิมแสดงในร้านปลายทาง
```

### **ย้ายภายนอก (Cut)**
```
1. เลือก "ย้ายภายนอก"
2. กรอกราคาที่ตัด (required)
3. ไม่ต้องเลือกร้าน
4. ยืนยันตัด
   ↓
5. เปลี่ยน status = 'removed'
6. บันทึก remove_date, remove_price
7. ซิมแสดงในแท็บ "ตัดออก"
```

---

## 🎨 UI/UX

### **Modal "ตัดซิมการ์ด"**

#### ส่วนบน: ข้อมูลซิม
```
┌─────────────────────────────────────┐
│ ข้อมูลซิมการ์ด                      │
│ ค่าย: DTAC                          │
│ เบอร์: 0989934742                   │
│ ราคาทุน: ฿35.00                     │
└─────────────────────────────────────┘
```

#### ส่วนกลาง: เลือกประเภท
```
ประเภทการตัด *
┌─────────────────────────────────────┐
│ ▼ ย้ายภายใน                         │
└─────────────────────────────────────┘
💡 หมายเหตุ: ถ้าต้องการให้ซิมการ์ดแสดงที่ร้านอื่น ให้เลือก "ย้ายภายใน"
```

#### ถ้าเลือก "ย้ายภายใน":
```
ย้ายไปร้าน *
┌─────────────────────────────────────┐
│ ▼ เลือกร้านปลายทาง                 │
│   ร้านไอเลิฟโฟน - ศาลายา            │
│   ร้านไอเลิฟโฟน - คลองโยง           │
└─────────────────────────────────────┘

วันที่ *
หมายเหตุ
```

#### ถ้าเลือก "ย้ายภายนอก":
```
ราคาที่ตัด (฿) *
┌─────────────────────────────────────┐
│ 35.00                                │
└─────────────────────────────────────┘
ระบุราคาที่ต้องการตัดออก

วันที่ *
หมายเหตุ
```

---

## 🧪 ตัวอย่างการใช้งาน

### **ตัวอย่างที่ 1: ย้ายซิม DTAC จากศาลายา → คลองโยง**

**Input:**
- ซิม: DTAC 0989934742 (ร้านศาลายา)
- ประเภท: **ย้ายภายใน**
- ย้ายไปร้าน: **คลองโยง**
- วันที่: 26/11/2568
- หมายเหตุ: เติมสต็อกร้านคลองโยง

**Output:**
```
✅ ย้ายซิมการ์ดเรียบร้อยแล้ว
   ไปยัง: ร้านคลองโยง
```

**ผลลัพธ์ใน Database:**
```sql
UPDATE simcards SET
  store = 'klongyong',
  note = 'ย้ายไป ร้านคลองโยง 26/11/2568 - เติมสต็อกร้านคลองโยง'
WHERE id = 'SIM-xxx';
```

**ผลลัพธ์ในหน้าเว็บ:**
- ศาลายา: ซิมหายจากแท็บ "พร้อมขาย"
- คลองโยง: ซิมปรากฏในแท็บ "พร้อมขาย" ✓

---

### **ตัวอย่างที่ 2: ตัดซิม AIS ออกจากระบบ**

**Input:**
- ซิม: AIS 0634265357 (ร้านศาลายา)
- ประเภท: **ย้ายภายนอก**
- ราคาที่ตัด: ฿35.00
- วันที่: 26/11/2568
- หมายเหตุ: ซิมเสีย

**Output:**
```
✅ ตัดซิมการ์ดเรียบร้อยแล้ว
```

**ผลลัพธ์ใน Database:**
```sql
UPDATE simcards SET
  status = 'removed',
  remove_date = '2025-11-26',
  remove_price = 35.00,
  note = 'ตัดออก 26/11/2568 - ซิมเสีย'
WHERE id = 'SIM-xxx';
```

**ผลลัพธ์ในหน้าเว็บ:**
- ศาลายา: ซิมหายจากแท็บ "พร้อมขาย"
- ศาลายา: ซิมปรากฏในแท็บ "ตัดออก" ✓

---

## 📊 สรุปความแตกต่าง

| ฟีเจอร์ | ย้ายภายใน (Transfer) | ย้ายภายนอก (Cut) |
|---------|---------------------|------------------|
| **ซิมหายจากร้านเดิม** | ✅ ใช่ | ✅ ใช่ |
| **ซิมปรากฏที่ร้านอื่น** | ✅ ใช่ | ❌ ไม่ |
| **ซิมปรากฏแท็บ "ตัดออก"** | ❌ ไม่ | ✅ ใช่ |
| **ต้องเลือกร้านปลายทาง** | ✅ ใช่ | ❌ ไม่ |
| **ต้องกรอกราคาตัด** | ❌ ไม่ | ✅ ใช่ |
| **เปลี่ยน status** | ❌ ไม่ | ✅ → 'removed' |
| **เปลี่ยน store** | ✅ ใช่ | ❌ ไม่ |

---

## 🔍 การตรวจสอบ

### ตรวจสอบการย้ายร้าน
```sql
-- ดูซิมที่ย้ายร้าน (ดูจาก note)
SELECT 
    provider,
    phone_number,
    store,
    note
FROM simcards 
WHERE note LIKE '%ย้ายไป%'
ORDER BY updated_at DESC;
```

### ตรวจสอบการตัด
```sql
-- ดูซิมที่ตัดออก
SELECT 
    provider,
    phone_number,
    remove_price,
    remove_date,
    status,
    note
FROM simcards 
WHERE status = 'removed'
ORDER BY remove_date DESC;
```

---

## ⚠️ หมายเหตุ

### 1. การเลือกร้านปลายทาง
- ระบบจะ filter ร้านต้นทางออกอัตโนมัติ
- จะแสดงเฉพาะร้านอื่นที่ย้ายได้

### 2. Default Option
- เมื่อเปิด Modal จะ default เป็น **"ย้ายภายใน"** (แนะนำ)
- เพราะส่วนใหญ่ต้องการย้ายร้านมากกว่าตัดออก

### 3. การกรอกข้อมูล
- **ย้ายภายใน**: ต้องเลือกร้าน (ไม่ต้องกรอกราคา)
- **ย้ายภายนอก**: ต้องกรอกราคา (ไม่ต้องเลือกร้าน)

---

## ✅ สรุป

ระบบซิมการ์ดมีฟังก์ชันครบถ้วนแล้ว เหมือนกับระบบเครื่อง:

✅ **ตัด** (ย้ายภายนอก) - ตัดออกจากระบบ  
✅ **ย้ายร้าน** (ย้ายภายใน) - ย้ายไปร้านอื่น  
✅ **Toggle UI** - แสดง/ซ่อนช่องตามประเภท  
✅ **Validation** - ตรวจสอบข้อมูลครบถ้วน  
✅ **Confirmation** - แสดง popup ยืนยัน  
✅ **Database Update** - อัปเดตข้อมูลถูกต้อง  
✅ **Console Log** - มี log ตรวจสอบการทำงาน  

พร้อมใช้งานแล้ว! 🎉

