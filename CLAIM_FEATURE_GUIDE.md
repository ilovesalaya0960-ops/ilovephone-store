# 📋 คู่มือการใช้งานฟีเจอร์ "เคลม"

## 🎯 ภาพรวม

ฟีเจอร์ "เคลม" ช่วยให้คุณสามารถจัดการเครื่องที่ต้องการส่งเคลมได้อย่างเป็นระบบ โดยเครื่องจะถูกแยกเก็บไว้ในแท็บ "เคลม" และสามารถคืนกลับมาที่สต๊อคได้เมื่อได้รับเครื่องคืนมา

---

## 🚀 วิธีใช้งาน

### 1️⃣ การเคลมเครื่อง

#### หน้าเครื่องมือหนึ่ง
1. เปิดหน้า "เครื่องใหม่"
2. ไปที่แท็บ "สต๊อค"
3. เลือกเครื่องที่ต้องการเคลม
4. ใน dropdown "การจัดการ" → เลือก **"เคลม"**
5. กดปุ่ม **"ตกลง"**
6. ระบุข้อมูล:
   - **วันที่เคลม**: (ค่าเริ่มต้นเป็นวันปัจจุบัน)
   - **หมายเหตุการเคลม**: เหตุผลหรือรายละเอียด (เช่น "จอแตก", "แบตบวม")
7. กด **"บันทึกเคลม"**
8. ✅ เครื่องจะถูกย้ายไปแท็บ "เคลม"

#### หน้าเครื่องมือสอง
- ขั้นตอนเหมือนกัน แต่เปิดหน้า "เครื่องมือสอง" แทน

---

### 2️⃣ การคืนเครื่องกลับสต๊อค

#### หลังจากได้รับเครื่องคืนจากการเคลม
1. เปิดหน้า "เครื่องใหม่" หรือ "เครื่องมือสอง"
2. ไปที่แท็บ **"เคลม"**
3. เลือกเครื่องที่ได้รับคืนมา
4. ใน dropdown "การจัดการ" → เลือก **"คืนสต๊อค"**
5. กดปุ่ม **"ตกลง"**
6. ระบุข้อมูล:
   - **วันที่คืนสต๊อค**: (ค่าเริ่มต้นเป็นวันปัจจุบัน)
   - **หมายเหตุการคืนสต๊อค**: รายละเอียด (เช่น "เปลี่ยนจอใหม่", "เปลี่ยนแบตใหม่")
7. กด **"คืนสต๊อค"**
8. ✅ เครื่องจะถูกย้ายกลับไปแท็บ "สต๊อค"

---

## 📊 โครงสร้างแท็บ

### หน้าเครื่องมือหนึ่ง
```
┌─────────┬──────────┬─────────┬────────┐
│ สต๊อค  │ ขายแล้ว │ ตัดออก │ เคลม   │
└─────────┴──────────┴─────────┴────────┘
```

### หน้าเครื่องมือสอง
```
┌─────────┬──────────┬─────────┬────────┐
│ สต๊อค  │ ขายแล้ว │ ตัดออก │ เคลม   │
└─────────┴──────────┴─────────┴────────┘
```

---

## 🔄 Flow การทำงาน

```
สต๊อค
  │
  ├─→ ขาย → ขายแล้ว
  ├─→ ผ่อน → หน้าเครื่องผ่อน
  ├─→ ตัด → ตัดออก (สต๊อคหาย)
  └─→ เคลม
        │
        └─→ คืนสต๊อค → กลับสต๊อค
```

---

## 💾 ข้อมูลที่เก็บ

### เมื่อเคลมเครื่อง
- `status` → `'claimed'`
- `claim_date` → วันที่เคลม
- `sale_date` → วันที่เคลม (สำหรับการแสดงผล)
- `note` → เพิ่มข้อมูลการเคลม

### เมื่อคืนสต๊อค
- `status` → `'stock'`
- `claim_date` → `NULL`
- `sale_date` → `NULL`
- `note` → เพิ่มข้อมูลการคืนสต๊อค (เก็บประวัติการเคลมไว้)

---

## 📋 ตารางในแท็บ "เคลม"

### คอลัมน์ที่แสดง
1. ยี่ห้อ
2. รุ่น
3. สี
4. IMEI
5. RAM/ROM
6. สภาพเครื่อง (เฉพาะเครื่องมือสอง)
7. ราคาทุน
8. ราคาขาย
9. **วันที่เคลม** 📅
10. หมายเหตุ
11. การจัดการ
    - รายการ (ดูรายละเอียด)
    - **คืนสต๊อค** ↩️
    - แก้ไข
    - ลบ

---

## ⚙️ การตั้งค่าเบื้องต้น (Database)

### 1. รัน Migration
```bash
mysql -u root -p ilovephone_db < server/migrations/add_claim_date_to_devices.sql
```

หรือใน **Sequel Ace**:
1. เปิด Sequel Ace
2. เลือก database: `ilovephone_db`
3. คัดลอกและรันคำสั่งจากไฟล์ `add_claim_date_to_devices.sql`

### 2. Restart Server (หากจำเป็น)
```bash
./restart-servers.sh
```

---

## 🎯 กรณีการใช้งาน

### Use Case 1: จอแตก ต้องส่งเคลม
```
1. เครื่อง: iPhone 13 Pro Max
2. ปัญหา: จอแตก
3. การจัดการ:
   ✅ เลือก "เคลม" → ระบุวันที่ + หมายเหตุ "จอแตก"
   ✅ บันทึก → ย้ายไปแท็บ "เคลม"
   ✅ รอรับเครื่องคืน
   ✅ ได้รับเครื่องคืน → "คืนสต๊อค" → ระบุวันที่ + หมายเหตุ "เปลี่ยนจอใหม่"
   ✅ เครื่องกลับมาสต๊อค พร้อมขาย
```

### Use Case 2: แบตเตอรี่บวม
```
1. เครื่อง: Samsung S23 Ultra
2. ปัญหา: แบตเตอรี่บวม
3. การจัดการ:
   ✅ เลือก "เคลม" → หมายเหตุ "แบตบวม, ส่งเคลม Samsung"
   ✅ รอแบตใหม่
   ✅ ได้รับแบตคืน → "คืนสต๊อค" → หมายเหตุ "เปลี่ยนแบตใหม่"
   ✅ พร้อมขาย
```

---

## 🔍 การกรองและค้นหา

### กรองตามเดือน
- **ไม่กรอง** (default) → แสดงเดือนปัจจุบัน
- **กรอง** → แสดงช่วงวันที่ที่เลือก

### ค้นหา
- ยี่ห้อ, รุ่น, สี, IMEI, RAM/ROM
- สภาพเครื่อง (เครื่องมือสอง)

---

## 📱 สถานะเครื่องทั้งหมด

| สถานะ | คำอธิบาย | แท็บ |
|-------|---------|------|
| `stock` | อยู่ในสต๊อค | สต๊อค |
| `sold` | ขายแล้ว | ขายแล้ว |
| `removed` | ตัดออก/สต๊อคหาย | ตัดออก |
| `claimed` | ส่งเคลม | **เคลม** (ใหม่!) |

---

## ⚠️ ข้อควรระวัง

1. **การเคลม** = ย้ายเครื่องไปแท็บ "เคลม" (ไม่ใช่การลบ)
2. **คืนสต๊อค** = เครื่องกลับมาที่แท็บ "สต๊อค" พร้อมขาย
3. **ประวัติการเคลม** = ถูกเก็บไว้ใน "หมายเหตุ"
4. **การลบ** = ลบออกจากระบบถาวร (ไม่แนะนำ ให้ใช้ "ตัด" แทน)

---

## 🧪 การทดสอบ

### Test 1: เคลมเครื่องใหม่
1. เปิดหน้าเครื่องมือหนึ่ง
2. เลือกเครื่องในสต๊อค → "เคลม"
3. ตรวจสอบ:
   - ✅ เครื่องหายจากแท็บ "สต๊อค"
   - ✅ เครื่องปรากฏในแท็บ "เคลม"
   - ✅ แสดงวันที่เคลมถูกต้อง
   - ✅ หมายเหตุบันทึกเหตุผลการเคลม

### Test 2: คืนสต๊อค
1. ไปที่แท็บ "เคลม"
2. เลือกเครื่อง → "คืนสต๊อค"
3. ตรวจสอบ:
   - ✅ เครื่องหายจากแท็บ "เคลม"
   - ✅ เครื่องกลับมาแท็บ "สต๊อค"
   - ✅ หมายเหตุเก็บประวัติการเคลมและคืนสต๊อค

### Test 3: เคลมเครื่องมือสอง
- ทดสอบเหมือน Test 1-2 แต่ใช้หน้าเครื่องมือสอง

---

## 📊 ตัวอย่างหมายเหตุ

### หมายเหตุเมื่อเคลม
```
เคลมวันที่ 1/12/2025: จอแตก ส่งเคลม Apple Service Center
```

### หมายเหตุเมื่อคืนสต๊อค
```
เคลมวันที่ 1/12/2025: จอแตก ส่งเคลม Apple Service Center

คืนสต๊อควันที่ 15/12/2025: เปลี่ยนจอใหม่ เครื่องพร้อมขาย
```

---

## ✅ สรุป

**ฟีเจอร์ที่เพิ่ม:**
1. ✅ แท็บ "เคลม" ในหน้าเครื่องมือหนึ่ง
2. ✅ แท็บ "เคลม" ในหน้าเครื่องมือสอง
3. ✅ Modal เคลมเครื่อง (ระบุวันที่ + หมายเหตุ)
4. ✅ Modal คืนสต๊อค (ระบุวันที่ + หมายเหตุ)
5. ✅ บันทึกประวัติการเคลม/คืนในหมายเหตุ
6. ✅ กรองตามเดือน
7. ✅ ค้นหาข้ามทุกฟิลด์

**ความแตกต่างจาก "ตัด":**
- **ตัด (removed)** = สต๊อคหาย, ตัดออก, ไม่กลับมาขาย
- **เคลม (claimed)** = ส่งซ่อม/เคลม, **สามารถกลับมาขายได้**

**พร้อมใช้งาน:** ✅ YES

---

## 🗄️ Database Schema

### new_devices
```sql
- claim_date DATE NULL
- claim_note TEXT NULL
```

### used_devices
```sql
- claim_date DATE NULL
- claim_note TEXT NULL
```

---

## 📞 Support

หากพบปัญหาการใช้งาน:
1. ตรวจสอบว่ารัน migration แล้ว
2. Restart server
3. ตรวจสอบ console.log ใน Developer Tools
4. ตรวจสอบว่ามีข้อมูลใน database
