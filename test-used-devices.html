<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏≠‡∏á</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Sarabun', Arial, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .test-section {
            background: #f8f9fa;
            padding: 25px;
            margin: 20px 0;
            border-radius: 12px;
            border-left: 5px solid #10b981;
        }

        .test-section h2 {
            color: #10b981;
            margin-bottom: 15px;
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: auto;
        }

        .status-pending { background: #fef3c7; color: #92400e; }
        .status-testing { background: #dbeafe; color: #1e40af; }
        .status-success { background: #d1fae5; color: #065f46; }
        .status-error { background: #fee2e2; color: #991b1b; }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .result-box {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
        }

        .result-box.success {
            border-color: #10b981;
            background: #f0fdf4;
        }

        .result-box.error {
            border-color: #ef4444;
            background: #fef2f2;
        }

        .result-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #374151;
            font-size: 16px;
        }

        .result-content {
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            color: #1f2937;
            max-height: 400px;
            overflow-y: auto;
            background: #f9fafb;
            padding: 15px;
            border-radius: 6px;
        }

        .icon {
            font-size: 24px;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e5e7eb;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .comparison-table {
            width: 100%;
            margin: 20px 0;
            border-collapse: collapse;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid #e5e7eb;
        }

        .comparison-table th {
            background: #10b981;
            color: white;
            font-weight: 600;
        }

        .comparison-table tr:hover {
            background: #f9fafb;
        }

        .highlight {
            background: #d1fae5;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ôªÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏≠‡∏á</h1>
        <p class="subtitle">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</p>

        <div class="progress-bar">
            <div class="progress-fill" id="progressBar" style="width: 0%">0%</div>
        </div>

        <!-- Test Section 1: API Connection -->
        <div class="test-section">
            <h2>
                <span class="icon">üîå</span> 
                1. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API
                <span class="status-badge status-pending" id="status1">‡∏£‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö</span>
            </h2>
            <button class="btn btn-primary" onclick="testAPIConnection()">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</button>
            <div id="result1"></div>
        </div>

        <!-- Test Section 2: Database Schema -->
        <div class="test-section">
            <h2>
                <span class="icon">üóÑÔ∏è</span> 
                2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                <span class="status-badge status-pending" id="status2">‡∏£‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö</span>
            </h2>
            <button class="btn btn-primary" onclick="testDatabaseSchema()">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Schema</button>
            <div id="result2"></div>
        </div>

        <!-- Test Section 3: CREATE -->
        <div class="test-section">
            <h2>
                <span class="icon">‚ûï</span> 
                3. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏≠‡∏á (CREATE)
                <span class="status-badge status-pending" id="status3">‡∏£‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö</span>
            </h2>
            <button class="btn btn-success" onclick="testCreateUsedDevice()">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button>
            <div id="result3"></div>
        </div>

        <!-- Test Section 4: READ -->
        <div class="test-section">
            <h2>
                <span class="icon">üîç</span> 
                4. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (READ)
                <span class="status-badge status-pending" id="status4">‡∏£‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö</span>
            </h2>
            <button class="btn btn-primary" onclick="testReadUsedDevice()">‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            <div id="result4"></div>
        </div>

        <!-- Test Section 5: UPDATE -->
        <div class="test-section">
            <h2>
                <span class="icon">‚úèÔ∏è</span> 
                5. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (UPDATE)
                <span class="status-badge status-pending" id="status5">‡∏£‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö</span>
            </h2>
            <button class="btn btn-primary" onclick="testUpdateUsedDevice()">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            <div id="result5"></div>
        </div>

        <!-- Test Section 6: DELETE -->
        <div class="test-section">
            <h2>
                <span class="icon">üóëÔ∏è</span> 
                6. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (DELETE)
                <span class="status-badge status-pending" id="status6">‡∏£‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö</span>
            </h2>
            <button class="btn btn-danger" onclick="testDeleteUsedDevice()">‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            <div id="result6"></div>
        </div>

        <!-- Test Section 7: Comparison -->
        <div class="test-section">
            <h2>
                <span class="icon">‚öñÔ∏è</span> 
                7. ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
                <span class="status-badge status-pending" id="status7">‡∏£‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö</span>
            </h2>
            <button class="btn btn-primary" onclick="testComparison()">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</button>
            <div id="result7"></div>
        </div>

        <!-- Run All -->
        <div class="test-section" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border: none;">
            <h2 style="color: white;">
                <span class="icon">üöÄ</span> 
                ‡∏£‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </h2>
            <button class="btn btn-primary" style="background: white; color: #10b981;" onclick="runAllTests()">
                üß™ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </button>
            <button class="btn btn-secondary" onclick="resetTests()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        let testDeviceId = null;
        let testResults = { total: 7, passed: 0, failed: 0 };

        function updateProgress() {
            const completed = testResults.passed + testResults.failed;
            const percentage = Math.round((completed / testResults.total) * 100);
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = percentage + '%';
            progressBar.textContent = percentage + '%';
        }

        function setStatus(testNum, status) {
            const statusEl = document.getElementById(`status${testNum}`);
            statusEl.className = `status-badge status-${status}`;
            statusEl.textContent = status === 'success' ? '‚úÖ ‡∏ú‡πà‡∏≤‡∏ô' : 
                                  status === 'error' ? '‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô' : 
                                  status === 'testing' ? '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...' : '‡∏£‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö';

            if (status === 'success') testResults.passed++;
            if (status === 'error') testResults.failed++;
            updateProgress();
        }

        function showResult(testNum, title, content, isSuccess = true) {
            const resultDiv = document.getElementById(`result${testNum}`);
            resultDiv.innerHTML = `
                <div class="result-box ${isSuccess ? 'success' : 'error'}">
                    <div class="result-title">${isSuccess ? '‚úÖ' : '‚ùå'} ${title}</div>
                    <div class="result-content">${content}</div>
                </div>
            `;
        }

        async function testAPIConnection() {
            setStatus(1, 'testing');
            try {
                const response = await fetch(`${API_BASE}/usedDevices?store=salaya`);
                if (response.ok) {
                    const data = await response.json();
                    showResult(1, '‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 
                        `‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n‚úÖ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ\nüìä ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏≠‡∏á: ${data.length} ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á`);
                    setStatus(1, 'success');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                showResult(1, '‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', `‚ùå ${error.message}`, false);
                setStatus(1, 'error');
            }
        }

        async function testDatabaseSchema() {
            setStatus(2, 'testing');
            try {
                const response = await fetch(`${API_BASE}/usedDevices?store=salaya`);
                const devices = await response.json();

                if (devices.length > 0) {
                    const device = devices[0];
                    let html = '‚úÖ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:\n\n';
                    html += '‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô:\n';
                    html += `  ${device.hasOwnProperty('brand') ? '‚úÖ' : '‚ùå'} brand (‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠)\n`;
                    html += `  ${device.hasOwnProperty('model') ? '‚úÖ' : '‚ùå'} model (‡∏£‡∏∏‡πà‡∏ô)\n`;
                    html += `  ${device.hasOwnProperty('color') ? '‚úÖ' : '‚ùå'} color (‡∏™‡∏µ)\n`;
                    html += `  ${device.hasOwnProperty('imei') ? '‚úÖ' : '‚ùå'} imei (IMEI)\n`;
                    html += `  ${device.hasOwnProperty('ram') ? '‚úÖ' : '‚ùå'} ram (RAM)\n`;
                    html += `  ${device.hasOwnProperty('rom') ? '‚úÖ' : '‚ùå'} rom (ROM)\n\n`;
                    
                    html += '‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÉ‡∏´‡∏°‡πà:\n';
                    html += `  ${device.hasOwnProperty('purchased_from') ? '‚úÖ' : '‚ùå'} purchased_from (‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏≤‡∏Å)\n`;
                    html += `  ${device.hasOwnProperty('device_category') ? '‚úÖ' : '‚ùå'} device_category (‡∏´‡∏°‡∏ß‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)\n`;
                    html += `  ${device.hasOwnProperty('device_condition') ? '‚úÖ' : '‚ùå'} device_condition (‡∏™‡∏†‡∏≤‡∏û‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)\n\n`;
                    
                    html += '‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ:\n';
                    html += `  ${device.hasOwnProperty('purchase_price') ? '‚úÖ' : '‚ùå'} purchase_price (‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠)\n`;
                    html += `  ${device.hasOwnProperty('sale_price') ? '‚úÖ' : '‚ùå'} sale_price (‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢)\n`;
                    html += `  ${device.hasOwnProperty('status') ? '‚úÖ' : '‚ùå'} status (‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞)\n`;

                    const hasAllFields = device.hasOwnProperty('purchased_from') && 
                                        device.hasOwnProperty('device_category') &&
                                        device.hasOwnProperty('device_condition');

                    showResult(2, '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Schema ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', html, hasAllFields);
                    setStatus(2, hasAllFields ? 'success' : 'error');
                } else {
                    showResult(2, '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏≠‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô', false);
                    setStatus(2, 'error');
                }
            } catch (error) {
                showResult(2, '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', `‚ùå ${error.message}`, false);
                setStatus(2, 'error');
            }
        }

        async function testCreateUsedDevice() {
            setStatus(3, 'testing');
            testDeviceId = 'UTEST' + Date.now();

            const newDevice = {
                id: testDeviceId,
                brand: 'Samsung',
                model: 'Galaxy S21 (‡∏°‡∏∑‡∏≠‡∏™‡∏≠‡∏á)',
                color: 'Phantom Gray',
                imei: 'UTEST' + Date.now(),
                ram: '8',
                rom: '256',
                purchased_from: '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡∏ô‡∏≤‡∏¢ A',
                device_category: 'Active',
                device_condition: 'excellent',
                purchase_price: 15000,
                import_date: new Date().toISOString().split('T')[0],
                sale_price: 19000,
                sale_date: null,
                status: 'stock',
                note: '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏≠‡∏á',
                store: 'salaya'
            };

            try {
                const response = await fetch(`${API_BASE}/usedDevices`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newDevice)
                });

                if (response.ok) {
                    const result = await response.json();
                    showResult(3, '‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 
                        `‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Database ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n\nID: ${testDeviceId}\n‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠: ${newDevice.brand}\n‡∏£‡∏∏‡πà‡∏ô: ${newDevice.model}\n‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏≤‡∏Å: ${newDevice.purchased_from}\n‡∏´‡∏°‡∏ß‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á: ${newDevice.device_category}\n‡∏™‡∏†‡∏≤‡∏û: ${newDevice.device_condition}\n‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠: ${newDevice.purchase_price} ‡∏ö‡∏≤‡∏ó`);
                    setStatus(3, 'success');
                } else {
                    const error = await response.json();
                    throw new Error(JSON.stringify(error));
                }
            } catch (error) {
                showResult(3, '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', `‚ùå ${error.message}`, false);
                setStatus(3, 'error');
            }
        }

        async function testReadUsedDevice() {
            setStatus(4, 'testing');
            if (!testDeviceId) {
                showResult(4, '‡πÑ‡∏°‡πà‡∏°‡∏µ ID', '‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô', false);
                setStatus(4, 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/usedDevices/${testDeviceId}`);
                const device = await response.json();

                if (response.ok) {
                    let html = '‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n\n';
                    html += `ID: ${device.id}\n`;
                    html += `‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠: ${device.brand}\n`;
                    html += `‡∏£‡∏∏‡πà‡∏ô: ${device.model}\n`;
                    html += `‡∏™‡∏µ: ${device.color}\n`;
                    html += `RAM/ROM: ${device.ram}/${device.rom} GB\n`;
                    html += `‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏≤‡∏Å: ${device.purchased_from || '(‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏)'}\n`;
                    html += `‡∏´‡∏°‡∏ß‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á: ${device.device_category || '(‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏)'}\n`;
                    html += `‡∏™‡∏†‡∏≤‡∏û‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á: ${device.device_condition || '(‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏)'}\n`;
                    html += `‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠: ${device.purchase_price} ‡∏ö‡∏≤‡∏ó\n`;
                    html += `‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢: ${device.sale_price} ‡∏ö‡∏≤‡∏ó\n`;
                    html += `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${device.status}\n`;

                    showResult(4, '‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', html);
                    setStatus(4, 'success');
                } else {
                    throw new Error(device.error || 'Not found');
                }
            } catch (error) {
                showResult(4, '‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', `‚ùå ${error.message}`, false);
                setStatus(4, 'error');
            }
        }

        async function testUpdateUsedDevice() {
            setStatus(5, 'testing');
            if (!testDeviceId) {
                showResult(5, '‡πÑ‡∏°‡πà‡∏°‡∏µ ID', '‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô', false);
                setStatus(5, 'error');
                return;
            }

            const updateData = {
                purchased_from: '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡∏ô‡∏≤‡∏¢ B (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß)',
                device_category: 'No Active',
                device_condition: 'good',
                sale_price: 18500
            };

            try {
                const response = await fetch(`${API_BASE}/usedDevices/${testDeviceId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updateData)
                });

                if (response.ok) {
                    const verify = await fetch(`${API_BASE}/usedDevices/${testDeviceId}`);
                    const updated = await verify.json();

                    let html = '‚úÖ ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n\n';
                    html += `‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏≤‡∏Å: ${updated.purchased_from}\n`;
                    html += `‡∏´‡∏°‡∏ß‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á: ${updated.device_category}\n`;
                    html += `‡∏™‡∏†‡∏≤‡∏û‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á: ${updated.device_condition}\n`;
                    html += `‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢: ${updated.sale_price} ‡∏ö‡∏≤‡∏ó\n\n`;
                    html += '‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢';

                    showResult(5, '‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', html);
                    setStatus(5, 'success');
                } else {
                    const error = await response.json();
                    throw new Error(error.error || 'Update failed');
                }
            } catch (error) {
                showResult(5, '‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', `‚ùå ${error.message}`, false);
                setStatus(5, 'error');
            }
        }

        async function testDeleteUsedDevice() {
            setStatus(6, 'testing');
            if (!testDeviceId) {
                showResult(6, '‡πÑ‡∏°‡πà‡∏°‡∏µ ID', '‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô', false);
                setStatus(6, 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/usedDevices/${testDeviceId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    const verify = await fetch(`${API_BASE}/usedDevices/${testDeviceId}`);
                    const isDeleted = verify.status === 404;

                    if (isDeleted) {
                        showResult(6, '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 
                            `‚úÖ ‡∏•‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ID: ${testDeviceId} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß`);
                        setStatus(6, 'success');
                        testDeviceId = null;
                    } else {
                        throw new Error('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
                    }
                } else {
                    const error = await response.json();
                    throw new Error(error.error || 'Delete failed');
                }
            } catch (error) {
                showResult(6, '‡∏•‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', `‚ùå ${error.message}`, false);
                setStatus(6, 'error');
            }
        }

        async function testComparison() {
            setStatus(7, 'testing');
            try {
                const [newDevices, usedDevices] = await Promise.all([
                    fetch(`${API_BASE}/newDevices?store=salaya`).then(r => r.json()),
                    fetch(`${API_BASE}/usedDevices?store=salaya`).then(r => r.json())
                ]);

                const newSample = newDevices[0] || {};
                const usedSample = usedDevices[0] || {};

                let html = `<table class="comparison-table">
                    <tr>
                        <th>‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå</th>
                        <th>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</th>
                        <th>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏≠‡∏á</th>
                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                    </tr>
                    <tr>
                        <td>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td>
                        <td>${newDevices.length} ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</td>
                        <td>${usedDevices.length} ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</td>
                        <td>‚ÑπÔ∏è</td>
                    </tr>
                    <tr>
                        <td>‡∏ü‡∏¥‡∏•‡∏î‡πå: purchased_from</td>
                        <td>${newSample.hasOwnProperty('purchased_from') ? '‚úÖ' : '‚ùå'}</td>
                        <td>${usedSample.hasOwnProperty('purchased_from') ? '‚úÖ' : '‚ùå'}</td>
                        <td>${newSample.hasOwnProperty('purchased_from') && usedSample.hasOwnProperty('purchased_from') ? '‚úÖ' : '‚ùå'}</td>
                    </tr>
                    <tr>
                        <td>‡∏ü‡∏¥‡∏•‡∏î‡πå: device_category</td>
                        <td>${newSample.hasOwnProperty('device_category') ? '‚úÖ' : '‚ùå'}</td>
                        <td>${usedSample.hasOwnProperty('device_category') ? '‚úÖ' : '‚ùå'}</td>
                        <td>${newSample.hasOwnProperty('device_category') && usedSample.hasOwnProperty('device_category') ? '‚úÖ' : '‚ùå'}</td>
                    </tr>
                    <tr>
                        <td>‡∏ü‡∏¥‡∏•‡∏î‡πå: device_condition</td>
                        <td>N/A</td>
                        <td>${usedSample.hasOwnProperty('device_condition') ? '‚úÖ' : '‚ùå'}</td>
                        <td>${usedSample.hasOwnProperty('device_condition') ? '‚úÖ' : '‚ùå'}</td>
                    </tr>
                    <tr>
                        <td>Filter ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ</td>
                        <td>‚úÖ</td>
                        <td>‚úÖ</td>
                        <td>‚úÖ</td>
                    </tr>
                    <tr>
                        <td>CRUD Operations</td>
                        <td>‚úÖ</td>
                        <td>‚úÖ</td>
                        <td>‚úÖ</td>
                    </tr>
                </table>`;

                const allMatch = usedSample.hasOwnProperty('purchased_from') && 
                                usedSample.hasOwnProperty('device_category') &&
                                usedSample.hasOwnProperty('device_condition');

                showResult(7, '‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', html, allMatch);
                setStatus(7, allMatch ? 'success' : 'error');
            } catch (error) {
                showResult(7, '‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', `‚ùå ${error.message}`, false);
                setStatus(7, 'error');
            }
        }

        async function runAllTests() {
            resetTests();
            await new Promise(r => setTimeout(r, 500));
            await testAPIConnection();
            await new Promise(r => setTimeout(r, 1000));
            await testDatabaseSchema();
            await new Promise(r => setTimeout(r, 1000));
            await testCreateUsedDevice();
            await new Promise(r => setTimeout(r, 1000));
            await testReadUsedDevice();
            await new Promise(r => setTimeout(r, 1000));
            await testUpdateUsedDevice();
            await new Promise(r => setTimeout(r, 1000));
            await testDeleteUsedDevice();
            await new Promise(r => setTimeout(r, 1000));
            await testComparison();
        }

        function resetTests() {
            testResults = { total: 7, passed: 0, failed: 0 };
            for (let i = 1; i <= 7; i++) {
                setStatus(i, 'pending');
                document.getElementById(`result${i}`).innerHTML = '';
            }
            updateProgress();
        }
    </script>
</body>
</html>

